# 06 NumPy 切片和索引

在 NumPy 中，如果想要访问，或修改数组中的元素，您可以采用索引或切片的方式，比如使用从 0 开始的索引依次访问数组中的元素，这与 Python 的 list 列表是相同的。

NumPy 提供了多种类型的索引方式，常用方式有两种：基本切片与高级索引。

## Python切片

Python中符合切片并且常用的有：列表，字符串，元组。
下面那列表来说明，其他的也是一样的。
格式：[开头：结束：步长]
开头：当步长>0时，不写默认0。当步长<0时，不写默认-1
结束：当步长>0时，不写默认列表长度加一。当步长<0时，不写默认负的列表长度减一
步长：默认1，>0 是从左往右走，<0是从右往左走
**遵循左闭右开原则，如：[0:9]等价于数学中的[0,9)**

![](https://raw.githubusercontent.com/XuanhaoZhu98/image_hosting/main/img/202204210912129.png)

## 基本切片

NumPy 内置函数 slice() 可以用来构造切片对象，该函数需要传递三个参数值分别是 start（起始索引）、stop（终止索引） 和 step（步长） ，通过它可以实现从原数组的上切割出一个新数组。

示例如下：

```python
import numpy as np
a = np.arange(10)
#生成切片对象
s = slice(2,9,3)#从索引2开始到索引9停止，间隔时间为2
print(a[s])
```

输出结果：

```
[2 5 8]
```

您也可以通过冒号来分割切片参数，最终也能获得相同结果，示例如下：

```python
import numpy as np
a = np.arange(10)
b = a[2:9:2]
print(b)
```

输出结果：

```
[2 5 8]
```

下面对冒号切片做简单地说明：

- 如果仅输入一个参数，则将返回与索引相对应的元素。 对于上述示例来说`[3] `就会返回 3。
- 如果在其前面插入“:”如`[:9]`，则会返回 0-8 的所有数字（不包含9）。
- 如是 `[2:] `则会返回 2-9 之间的数字。
- 如果在两个参数之间，如`[2:9]`，则对两个索引值之间的所有元素进行切片（不包括停止索引）。

下面对冒号类型的切片做了简单的实例演示：

```python
a = np.arange(10)
print(a[3])
print(a[-1])
print(a[2:])
print(a[2:5])
print(a[2:5:2])
print(a[5:2:-1])
print(a[-5:-2])
```

输出结果：

```
3
9
[2 3 4 5 6 7 8 9]
[2 3 4]
[2 4]
[5 4 3]
[5 6 7]
```

## 多维数组切片

对于多维数组来说，我们要按照行列的思想去理解它，形如 a[n,:]、a[:,n]、a[m:n,:]、a[:,m:n]，都属于二维数组的切片形式，中括号中的第一个位置代表截取行，第二个位置代表截取列，中间需用逗号隔开。注意，我们要将 m:n 看做是一个整体，使用切片操作二维数组的中括号中就有一个冒号，三维数组就会有两个冒号，以此类推，且每个冒号与之间用逗号隔开，如 a[1:,:] 它的含义可以这样理解：

- 行位置表示截取第一行开始到末行终止。
- 列位置表示截取所有的列。

多维数组切片操作，实例如下：

```python
import numpy as np
a = np.array([[1,2,3],[3,4,5],[4,5,6]])
print(a)
print(a[1:])
print(a[2:,2:])
print(a[2,:])
```

输出结果：

```
[[1 2 3]
 [3 4 5]
 [4 5 6]]
 
[[3 4 5]
 [4 5 6]]
 
[[6]]

[4 5 6]
```

注意：除了使用“:”表示全部行/列之外，还可以使用省略号“…”来使选择元组的长度与数组的维度相同。如果在行位置使用省略号，那么返回值将包含所有行元素，反之，则包含所有列元素。

实例如下：

```python
import numpy as np
#创建a数组
a = np.array([[1,2,3],[3,4,5],[4,5,6]])
#返回数组的第二列
print (a[...,1]) 
#返回数组的第二行
print (a[1,...])
#返回第二列后的所有项
print (a[...,1:])
```



```
[2 4 5]

[3 4 5]

[[2 3]
 [4 5]
 [5 6]]
```

多维数组也可以和一维数组一样设置起始位置和步长，可以总结为：array[start:stop:step,start:stop:step]，前面的start:stop:step表示行，后面的start:stop:step表示列

```python
import numpy as np
arr=np.arange(1,26).reshape((5,5))
print(arr)
print(arr[-1:-5:-1,1::2])
```

输出结果：

```
[[ 1  2  3  4  5]
 [ 6  7  8  9 10]
 [11 12 13 14 15]
 [16 17 18 19 20]
 [21 22 23 24 25]]
 
[[22 24]
 [17 19]
 [12 14]
 [ 7  9]]
```

NumPy 比一般的 Python 序列提供更多的索引方式。除了之前看到的用整数和切片的索引外，数组可以由整数数组索引、布尔索引及花式索引。

## 整数数组索引

当原数组是一维数组时，使用一维整型数组作为索引，那么索引结果就是相应索引位置上的元素:

```python
import numpy as np
x=np.array([1,2,3,4])
print(x[[0,2]])
```

输出结果：

```
[1 3]
```

如果原数组是二维数组，那么索引数组也需要是二维的，索引数组的元素值与被索引数组的每一行相对应

传入顺序索引数组示例如下：

```python
import numpy as np 
x=np.arange(32).reshape((8,4))
print(x)
print (x[[4,2,1,7]])
#相当于print (x[[4,2,1,7],:])
```

输出结果：

```
[[ 0  1  2  3]
 [ 4  5  6  7]
 [ 8  9 10 11]
 [12 13 14 15]
 [16 17 18 19]
 [20 21 22 23]
 [24 25 26 27]
 [28 29 30 31]]
 
[[16 17 18 19]
 [ 8  9 10 11]
 [ 4  5  6  7]
 [28 29 30 31]]
```

也可以使用倒序索引数组，示例如下：

```python
print (x[[-4,-2,-1,-7]])
```

输出结果：

```
[[16 17 18 19]
[24 25 26 27]
[28 29 30 31]
[ 4  5  6  7]]
```

可以选择数组中的任意一个元素，比如，选择第几行第几列的某个元素，示例如下：

```python
import numpy as np
#创建二维数组
x = np.array([[1,  2],  [3,  4],  [5,  6]])
print(x)
#[0,1,2]代表行索引;[0,1,0]代表列索引
y = x[[0,1,2],[0,1,0]] 
print (y)
```

输出结果是：

```
[[1 2]
 [3 4]
 [5 6]]
 
[1 4 5]
```

对上述示例做简单分析：将行、列索引组合会得到 (0,0)、(1,1) 和 (2,0) ，它们分别对应着输出结果在原数组中的索引位置。

下面再看一组示例：获取了 4*3 数组中的四个角上元素，它们对应的行索引是 [0,0] 和 [3,3]，列索引是 [0,2] 和 [0,2]。

```python
import numpy as np
b = np.array([[ 0, 1, 2],
              [ 3, 4, 5],
              [ 6, 7, 8],
              [ 9,10,11]])
r = np.array([[0,0],[3,3]])
c = np.array([[0,2],[0,2]])
#获取四个角的元素
s = b[r,c]
print(s)
```

输出结果：

```
[[ 0  2]
 [ 9 11]]
```

索引的维度增加，切片后的数组维度也会增加：

```python
import numpy as np
b = np.arange(1,25).reshape((4,6))
r = np.array([[[0,1],[1,2]],[[1,2],[2,3]]])
c = np.array([[[1,2],[0,1]],[[2,3],[1,2]]])
s = b[r,c]
print(s)
```

输出结果：

```
[[[ 2  9]
  [ 7 14]]

 [[ 9 16]
  [14 21]]]
```

您也可以将切片所使用的`:`或省略号`...`与整数数组索引结合使用，示例如下：

```python
import numpy as np
d = np.array([[ 0,  1,  2],
              [ 3,  4,  5],
              [ 6,  7,  8],
              [ 9, 10, 11]])
#对行列分别进行切片
e = d[1:4,1:3]
print(e)
#行使用基础索引，对列使用高级索引
f = d[1:4,[1,2]]
#显示切片后结果
print (f)
#对行使用省略号
h=d[...,1:]
print(h)
```

输出结果：

```
[[ 4  5]
 [ 7  8]
 [10 11]]
 
[[ 4  5]
 [ 7  8]
 [10 11]]
 
[[ 1  2]
 [ 4  5]
 [ 7  8]
 [10 11]]
```

numpy.ix_()函数根据多个序列构造一个开放网格，两个数组中的元素两两组合成索引：

```python
import numpy as np 
x=np.arange(10).reshape(2, 5) 
print(x)
print (x[np.ix_([0, 1],[2, 4])])
```

输出结果如下：

```
[[0 1 2 3 4]
 [5 6 7 8 9]]
[[2 4]
 [7 9]]
```

## 布尔数组索引

当输出的结果需要经过布尔运算（如比较运算）时，此时会使用到另一种高级索引方式，即布尔数组索引。下面示例返回数组中大于 6 的的所有元素：

```python
#返回所有大于6的数字组成的数组
import numpy as np
x = np.array([[ 0,  1,  2],[ 3,  4,  5],[ 6,  7,  8],[ 9, 10, 11]])
print (x[x > 6])
```

输出结果：

```
[ 7  8  9 10 11]
```

也可以使用逻辑运算符组合条件：

```python
import numpy as np
x = np.array([[ 0,  1,  2],[ 3,  4,  5],[ 6,  7,  8],[ 9, 10, 11]])
#使用小括号括住条件
print(x[(x > 5) & (x < 10)])
#使用np.logical_and方法
print(x[np.logical_and(x > 5, x < 10)])
#使用np.all方法
print(x[np.all([x > 5, x < 10],axis=0)])
```

输出结果：

```
[6 7 8 9]
[6 7 8 9]
[6 7 8 9]
```

我们可以使用`~`补码运算符来去除 NaN（即非数字元素），如下所示：

```python
import numpy as np
a = np.array([np.nan, 1,2,np.nan,3,4,5])
print(a[~np.isnan(a)])
```

输出结果：

```
[1. 2. 3. 4. 5.]
```

下面示例，删除数组中整数元素，如下所示：

```python
import numpy as np
a = np.array([1, 2+6j, 5, 3.5+5j])
print( a[np.iscomplex(a)])
```

输出结果如下：

```
[2. +6.j 3.5+5.j]
```

除此之外，还使用 mask 布尔值序列对数组进行取值的操作，称之为掩码，即掩盖掉不想显示的数据：

```python
import numpy as np
data=np.arange(1,11)
mask=[True,False,True,False,True,False,True,False,True,False]
print(data[mask])
```

输出结果：

```
[1 3 5 7 9]
```

掩码的进一步使用案例：

```python
import numpy as np
names=np.array(['James','Robert','Michael','Daniel','Paul','Kevin'])
data=np.random.randn(6,4)
print(names)
print(data)
mask=(names=="James")|(names=="Daniel")
print(mask)
print(data[mask])
```

输出结果：

```
['James' 'Robert' 'Michael' 'Daniel' 'Paul' 'Kevin']

[[ 0.20530453 -0.18595734  0.59509752  0.91983921]
 [ 2.22257391 -1.5609743   0.04027439  0.97880182]
 [ 0.03863509 -0.32581618  0.21819506 -0.0999609 ]
 [ 0.33983454  1.22613603 -0.33039745 -0.44225819]
 [-1.11067992  0.49909566 -0.27050853 -0.01217477]
 [-1.30098518 -0.27845879 -1.29647622 -0.38968573]]
 
[ True False False  True False False]

[[ 0.20530453 -0.18595734  0.59509752  0.91983921]
 [ 0.33983454  1.22613603 -0.33039745 -0.44225819]]
```

